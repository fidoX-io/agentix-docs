---
title: 'Network & Firewall Configuration'
description: 'Configure ports, firewall rules, and security for Agentix deployments'
icon: 'shield'
---

# Network & Firewall Configuration

This guide covers the network requirements, port configurations, and firewall rules needed for secure Agentix deployments.

## Required Ports

Agentix uses several ports for different services. The exposure requirements depend on your deployment architecture.

### Port Reference Table

| Service | Port(s) | Config Parameter | Internet Facing | Description |
|---------|---------|------------------|-----------------|-------------|
| **Core API** | 7880 | `port` | Via Load Balancer | Main API endpoint, WebSocket connections |
| **RTC TCP** | 7881 | `rtc.tcp_port` | Yes | WebRTC TCP fallback for restrictive firewalls |
| **RTC UDP Range** | 50000-60000 | `rtc.port_range_start/end` | Yes | WebRTC media channels (2 ports per participant) |
| **RTC UDP Mux** | 7882 | `rtc.udp_port` | Yes | (Optional) Single UDP port for all WebRTC traffic |
| **Database** | 5432 | N/A | Internal Only | PostgreSQL database connection |
| **Redis** | 6379 | N/A | Internal Only | Cache and session storage |
| **TURN TLS** | 5349 | `turn.tls_port` | Via Load Balancer | Encrypted TURN server (corporate firewall bypass) |
| **TURN UDP** | 3478 | `turn.udp_port` | Yes | TURN/STUN server for NAT traversal |
| **Prometheus** | 9090/9091 | `monitoring.prometheus_port` | Internal Only | Metrics collection |
| **Health Check** | 8080 | `monitoring.health_check_port` | Internal Only | Load balancer health checks |

<Note>
For **all-in-one deployments**, all services run on the same server. For **separate server architectures**, distribute services across dedicated machines.
</Note>

### Port Usage Examples

<Tabs>
<Tab title="All-in-One Server">
```yaml
# Single server port allocation
Server IP: 10.0.0.10

Services:
├── Core API: 10.0.0.10:7880 (behind load balancer)
├── RTC TCP: 10.0.0.10:7881 (direct internet)
├── RTC UDP: 10.0.0.10:50000-60000 (direct internet)
├── Database: 10.0.0.10:5432 (internal only)
├── Redis: 10.0.0.10:6379 (internal only)
└── TURN: 10.0.0.10:3478/5349 (direct internet)
```
</Tab>

<Tab title="Separate Servers">
```yaml
# Distributed architecture
Core Server (10.0.0.10):
├── API: 10.0.0.10:7880 (behind load balancer)
├── Database: 10.0.0.10:5432 (internal only)
└── Redis: 10.0.0.10:6379 (internal only)

RTC Server 1 (10.0.0.20):
├── RTC TCP: 10.0.0.20:7881 (direct internet)
├── RTC UDP: 10.0.0.20:50000-60000 (direct internet)
└── TURN: 10.0.0.20:3478/5349 (direct internet)

RTC Server 2 (10.0.0.21):
├── RTC TCP: 10.0.0.21:7881 (direct internet)
├── RTC UDP: 10.0.0.21:50000-60000 (direct internet)
└── TURN: 10.0.0.21:3478/5349 (direct internet)
```
</Tab>
</Tabs>

## Firewall Configuration

### Linux iptables Rules

<CodeGroup>
```bash All-in-One Server
#!/bin/bash
# Agentix All-in-One Firewall Rules

# Clear existing rules
iptables -F
iptables -X

# Default policies
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Allow loopback
iptables -A INPUT -i lo -j ACCEPT

# Allow established connections
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# SSH access (adjust port as needed)
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# HTTP/HTTPS (load balancer)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# Core API (from load balancer only)
iptables -A INPUT -p tcp -s 10.0.0.5 --dport 7880 -j ACCEPT

# RTC TCP
iptables -A INPUT -p tcp --dport 7881 -j ACCEPT

# RTC UDP range
iptables -A INPUT -p udp --dport 50000:60000 -j ACCEPT

# TURN server
iptables -A INPUT -p udp --dport 3478 -j ACCEPT
iptables -A INPUT -p tcp --dport 5349 -j ACCEPT

# Health checks (from load balancer)
iptables -A INPUT -p tcp -s 10.0.0.5 --dport 8080 -j ACCEPT

# Save rules
iptables-save > /etc/iptables/rules.v4
```

```bash Core Server Only
#!/bin/bash
# Agentix Core Server Firewall Rules

iptables -F && iptables -X
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Loopback and established connections
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Core API (from load balancer)
iptables -A INPUT -p tcp -s 10.0.0.5 --dport 7880 -j ACCEPT

# Database (from application servers only)
iptables -A INPUT -p tcp -s 10.0.0.20 --dport 5432 -j ACCEPT
iptables -A INPUT -p tcp -s 10.0.0.21 --dport 5432 -j ACCEPT

# Redis (from RTC servers)
iptables -A INPUT -p tcp -s 10.0.0.20 --dport 6379 -j ACCEPT
iptables -A INPUT -p tcp -s 10.0.0.21 --dport 6379 -j ACCEPT

# Prometheus (from monitoring)
iptables -A INPUT -p tcp -s 10.0.0.30 --dport 9090 -j ACCEPT

iptables-save > /etc/iptables/rules.v4
```

```bash RTC Server Only
#!/bin/bash
# Agentix RTC Server Firewall Rules

iptables -F && iptables -X
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Basic rules
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# RTC services (open to internet)
iptables -A INPUT -p tcp --dport 7881 -j ACCEPT
iptables -A INPUT -p udp --dport 50000:60000 -j ACCEPT

# TURN server
iptables -A INPUT -p udp --dport 3478 -j ACCEPT
iptables -A INPUT -p tcp --dport 5349 -j ACCEPT

# Communication with Core servers
iptables -A INPUT -p tcp -s 10.0.0.10 --dport 7881 -j ACCEPT

# Prometheus metrics
iptables -A INPUT -p tcp -s 10.0.0.30 --dport 9091 -j ACCEPT

iptables-save > /etc/iptables/rules.v4
```
</CodeGroup>

### UFW (Ubuntu Firewall) Rules

<CodeGroup>
```bash All-in-One UFW
# Enable UFW
sudo ufw enable

# Default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Basic services
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Agentix Core (from load balancer only)
sudo ufw allow from 10.0.0.5 to any port 7880

# RTC services
sudo ufw allow 7881/tcp
sudo ufw allow 50000:60000/udp

# TURN server
sudo ufw allow 3478/udp
sudo ufw allow 5349/tcp

# Health checks
sudo ufw allow from 10.0.0.5 to any port 8080

# Check status
sudo ufw status verbose
```

```bash Separate Servers UFW
# Core Server
sudo ufw allow ssh
sudo ufw allow from 10.0.0.5 to any port 7880  # Load balancer
sudo ufw allow from 10.0.0.20 to any port 5432  # RTC server 1
sudo ufw allow from 10.0.0.21 to any port 5432  # RTC server 2
sudo ufw allow from 10.0.0.30 to any port 9090  # Monitoring

# RTC Servers
sudo ufw allow ssh
sudo ufw allow 7881/tcp
sudo ufw allow 50000:60000/udp
sudo ufw allow 3478/udp
sudo ufw allow 5349/tcp
sudo ufw allow from 10.0.0.10 to any port 7881  # Core server
sudo ufw allow from 10.0.0.30 to any port 9091  # Monitoring
```
</CodeGroup>

## Cloud Provider Firewall Rules

### AWS Security Groups

<Tabs>
<Tab title="All-in-One Security Group">
```json
{
  "GroupName": "agentix-all-in-one",
  "Description": "Agentix All-in-One Server Security Group",
  "SecurityGroupRules": [
    {
      "Description": "SSH",
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "HTTP",
      "IpProtocol": "tcp",
      "FromPort": 80,
      "ToPort": 80,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "HTTPS",
      "IpProtocol": "tcp",
      "FromPort": 443,
      "ToPort": 443,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "RTC TCP",
      "IpProtocol": "tcp",
      "FromPort": 7881,
      "ToPort": 7881,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "RTC UDP Range",
      "IpProtocol": "udp",
      "FromPort": 50000,
      "ToPort": 60000,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "TURN UDP",
      "IpProtocol": "udp",
      "FromPort": 3478,
      "ToPort": 3478,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "TURN TLS",
      "IpProtocol": "tcp",
      "FromPort": 5349,
      "ToPort": 5349,
      "CidrIpv4": "0.0.0.0/0"
    }
  ]
}
```
</Tab>

<Tab title="Core Server Security Group">
```json
{
  "GroupName": "agentix-core",
  "Description": "Agentix Core Server Security Group",
  "SecurityGroupRules": [
    {
      "Description": "SSH",
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "CidrIpv4": "10.0.0.0/16"
    },
    {
      "Description": "Core API from Load Balancer",
      "IpProtocol": "tcp",
      "FromPort": 7880,
      "ToPort": 7880,
      "ReferencedGroupId": "sg-loadbalancer"
    },
    {
      "Description": "PostgreSQL from RTC Servers",
      "IpProtocol": "tcp",
      "FromPort": 5432,
      "ToPort": 5432,
      "ReferencedGroupId": "sg-agentix-rtc"
    },
    {
      "Description": "Redis from RTC Servers",
      "IpProtocol": "tcp",
      "FromPort": 6379,
      "ToPort": 6379,
      "ReferencedGroupId": "sg-agentix-rtc"
    }
  ]
}
```
</Tab>

<Tab title="RTC Server Security Group">
```json
{
  "GroupName": "agentix-rtc",
  "Description": "Agentix RTC Server Security Group",
  "SecurityGroupRules": [
    {
      "Description": "SSH",
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "CidrIpv4": "10.0.0.0/16"
    },
    {
      "Description": "RTC TCP",
      "IpProtocol": "tcp",
      "FromPort": 7881,
      "ToPort": 7881,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "RTC UDP Range",
      "IpProtocol": "udp",
      "FromPort": 50000,
      "ToPort": 60000,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "TURN Services",
      "IpProtocol": "udp",
      "FromPort": 3478,
      "ToPort": 3478,
      "CidrIpv4": "0.0.0.0/0"
    },
    {
      "Description": "TURN TLS",
      "IpProtocol": "tcp",
      "FromPort": 5349,
      "ToPort": 5349,
      "CidrIpv4": "0.0.0.0/0"
    }
  ]
}
```
</Tab>
</Tabs>

### Google Cloud Platform

<CodeGroup>
```bash GCP Firewall - All-in-One
# Create firewall rules for Agentix all-in-one
gcloud compute firewall-rules create agentix-http-https \
  --allow tcp:80,tcp:443 \
  --source-ranges 0.0.0.0/0 \
  --description "HTTP and HTTPS access"

gcloud compute firewall-rules create agentix-rtc \
  --allow tcp:7881,udp:50000-60000,udp:3478,tcp:5349 \
  --source-ranges 0.0.0.0/0 \
  --description "Agentix RTC and TURN services"

gcloud compute firewall-rules create agentix-internal \
  --allow tcp:7880,tcp:8080 \
  --source-ranges 10.0.0.0/8 \
  --description "Agentix internal services"
```

```bash GCP Firewall - Separate Servers
# Core server rules
gcloud compute firewall-rules create agentix-core-api \
  --allow tcp:7880 \
  --source-tags agentix-loadbalancer \
  --target-tags agentix-core \
  --description "Core API access from load balancer"

gcloud compute firewall-rules create agentix-database \
  --allow tcp:5432,tcp:6379 \
  --source-tags agentix-rtc \
  --target-tags agentix-core \
  --description "Database access from RTC servers"

# RTC server rules
gcloud compute firewall-rules create agentix-rtc-external \
  --allow tcp:7881,udp:50000-60000,udp:3478,tcp:5349 \
  --source-ranges 0.0.0.0/0 \
  --target-tags agentix-rtc \
  --description "RTC external access"
```
</CodeGroup>

### Azure Network Security Groups

```json
{
  "securityRules": [
    {
      "name": "AllowHTTPHTTPS",
      "properties": {
        "protocol": "Tcp",
        "sourcePortRange": "*",
        "destinationPortRanges": ["80", "443"],
        "sourceAddressPrefix": "*",
        "destinationAddressPrefix": "*",
        "access": "Allow",
        "priority": 1000,
        "direction": "Inbound"
      }
    },
    {
      "name": "AllowAgentixRTC",
      "properties": {
        "protocol": "*",
        "sourcePortRange": "*",
        "destinationPortRanges": ["7881", "50000-60000", "3478", "5349"],
        "sourceAddressPrefix": "*",
        "destinationAddressPrefix": "*",
        "access": "Allow",
        "priority": 1100,
        "direction": "Inbound"
      }
    }
  ]
}
```

## Docker & Kubernetes Network Configuration

### Docker Networking

<CodeGroup>
```bash Docker Host Network
# Use host networking for optimal RTC performance
docker run -d \
  --name agentix-server \
  --network host \
  --restart unless-stopped \
  -v /etc/agentix:/etc/agentix:ro \
  agentixhub/agentix:latest
```

```bash Docker Bridge Network
# Custom bridge network with port mapping
docker network create agentix-net

docker run -d \
  --name agentix-server \
  --network agentix-net \
  -p 80:80 \
  -p 443:443 \
  -p 7881:7881 \
  -p 50000-60000:50000-60000/udp \
  -p 3478:3478/udp \
  -p 5349:5349 \
  agentixhub/agentix:latest
```
</CodeGroup>

### Kubernetes Network Policies

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: agentix-network-policy
  namespace: agentix
spec:
  podSelector:
    matchLabels:
      app: agentix
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 7880
  - from: []  # Allow from anywhere
    ports:
    - protocol: TCP
      port: 7881
    - protocol: UDP
      port: 50000
      endPort: 60000
    - protocol: UDP
      port: 3478
    - protocol: TCP
      port: 5349
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: database
    ports:
    - protocol: TCP
      port: 5432
  - to:
    - namespaceSelector:
        matchLabels:
          name: redis
    ports:
    - protocol: TCP
      port: 6379
  - to: []  # Allow all outbound for external services
```

## Security Best Practices

### Network Segmentation

```yaml
# Network topology recommendation
Internet
    │
    ├─ Load Balancer (DMZ) - 10.0.1.0/24
    │   ├─ SSL Termination
    │   └─ DDoS Protection
    │
    ├─ Application Layer - 10.0.2.0/24
    │   ├─ Agentix Core Servers
    │   └─ Agentix RTC Servers
    │
    ├─ Data Layer - 10.0.3.0/24
    │   ├─ PostgreSQL Cluster
    │   └─ Redis Cluster
    │
    └─ Management - 10.0.4.0/24
        ├─ Monitoring (Prometheus/Grafana)
        ├─ Log Aggregation (ELK)
        └─ Backup Services
```

### Rate Limiting

Configure rate limiting at multiple layers:

```nginx
# Nginx rate limiting
http {
    limit_req_zone $binary_remote_addr zone=api:10m rate=100r/s;
    limit_req_zone $binary_remote_addr zone=websocket:10m rate=10r/s;
    
    server {
        location /api/ {
            limit_req zone=api burst=200 nodelay;
        }
        
        location /ws {
            limit_req zone=websocket burst=20 nodelay;
        }
    }
}
```

### DDoS Protection

<Tabs>
<Tab title="Cloudflare">
```yaml
# Cloudflare configuration
security_level: "medium"
ddos_protection: true
rate_limiting:
  api_endpoints: "1000/minute"
  websocket_connections: "100/minute"
ssl_mode: "strict"
```
</Tab>

<Tab title="AWS Shield">
```json
{
  "Protection": {
    "Id": "agentix-ddos-protection",
    "ResourceArn": "arn:aws:elasticloadbalancing:region:account:loadbalancer/app/agentix-alb/id",
    "ProtectionType": "ADVANCED"
  }
}
```
</Tab>
</Tabs>

## Troubleshooting Network Issues

### Common Connection Problems

<AccordionGroup>
<Accordion title="WebRTC Connection Failures">
**Symptoms**: Clients can't establish media connections

**Troubleshooting**:
```bash
# Check if RTC ports are accessible
nmap -p 7881,50000-50010 your-server.com

# Test STUN/TURN server
sudo tcpdump -i any port 3478

# Verify external IP detection
curl ifconfig.me
```

**Solutions**:
- Ensure UDP port range 50000-60000 is open
- Configure `use_external_ip: true` for cloud deployments
- Check NAT/firewall settings
</Accordion>

<Accordion title="API Connection Timeouts">
**Symptoms**: HTTP 504 errors, connection timeouts

**Troubleshooting**:
```bash
# Check load balancer health
curl -I https://your-domain.com/health

# Verify backend connectivity
telnet localhost 7880

# Check for port conflicts
sudo netstat -tlnp | grep 7880
```

**Solutions**:
- Increase nginx proxy timeouts
- Check if Agentix service is running
- Verify firewall rules allow load balancer access
</Accordion>

<Accordion title="Database Connection Issues">
**Symptoms**: Application errors, database connection failures

**Troubleshooting**:
```bash
# Test database connectivity
psql -h database-server -U agentix_user -d agentix_prod

# Check network connectivity
telnet database-server 5432

# Verify security group rules
```

**Solutions**:
- Update security groups to allow database access
- Check PostgreSQL configuration (postgresql.conf, pg_hba.conf)
- Verify connection limits and pool settings
</Accordion>
</AccordionGroup>

### Network Monitoring

```bash
# Monitor network connections
sudo netstat -antp | grep agentix

# Check bandwidth usage
sudo iftop -i eth0

# Monitor UDP traffic (for RTC)
sudo tcpdump -i any udp port 50000-60000

# Check connection states
ss -tuln | grep -E '(7880|7881|50000)'
```

## Next Steps

With networking and security configured, continue with:

<Card title="Architecture & Scaling" icon="sitemap" href="/developer-guide/self-hosting/vm">
  Explore containerization, Kubernetes deployment, and scaling strategies
</Card>